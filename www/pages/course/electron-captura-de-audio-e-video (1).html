
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Electron - Captura de áudio e vídeo</font></font></h1>






<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A captura de áudio e vídeo são características importantes se você estiver criando aplicativos para compartilhamento de tela, memos de voz, etc. Eles também são úteis se você precisar de um aplicativo para capturar a imagem do perfil.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos usar a </font><font style="vertical-align: inherit;">API </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getUserMedia</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HTML5 para capturar fluxos de áudio e vídeo com o Electron. </font><font style="vertical-align: inherit;">Vamos primeiro configurar nosso processo principal no arquivo main.js da seguinte maneira:</font></font></p>
<pre class="prettyprint notranslate prettyprinted" style=""><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">app</span><span class="pun">,</span><span class="pln"> </span><span class="typ">BrowserWindow</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'electron'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> url </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'url'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> path </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'path'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">let</span><span class="pln"> win

</span><span class="com">// Set the path where recordings will be saved</span><span class="pln">
app</span><span class="pun">.</span><span class="pln">setPath</span><span class="pun">(</span><span class="str">"userData"</span><span class="pun">,</span><span class="pln"> __dirname </span><span class="pun">+</span><span class="pln"> </span><span class="str">"/saved_recordings"</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">function</span><span class="pln"> createWindow</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   win </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BrowserWindow</span><span class="pun">({</span><span class="pln">width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">800</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">:</span><span class="pln"> </span><span class="lit">600</span><span class="pun">})</span><span class="pln">
   win</span><span class="pun">.</span><span class="pln">loadURL</span><span class="pun">(</span><span class="pln">url</span><span class="pun">.</span><span class="pln">format</span><span class="pun">({</span><span class="pln">
      pathname</span><span class="pun">:</span><span class="pln"> path</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">__dirname</span><span class="pun">,</span><span class="pln"> </span><span class="str">'index.html'</span><span class="pun">),</span><span class="pln">
      protocol</span><span class="pun">:</span><span class="pln"> </span><span class="str">'file:'</span><span class="pun">,</span><span class="pln">
      slashes</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
   </span><span class="pun">}))</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

app</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'ready'</span><span class="pun">,</span><span class="pln"> createWindow</span><span class="pun">)</span></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora que estabelecemos nosso processo principal, vamos criar o arquivo HTML que estará capturando esse conteúdo. </font><font style="vertical-align: inherit;">Crie um arquivo chamado </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index.html</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o seguinte conteúdo -</font></font></p>
<pre class="prettyprint notranslate prettyprinted" style=""><span class="dec">&lt;!DOCTYPE html&gt;</span><span class="pln">
</span><span class="tag">&lt;html&gt;</span><span class="pln">
   </span><span class="tag">&lt;head&gt;</span><span class="pln">
      </span><span class="tag">&lt;meta</span><span class="pln"> </span><span class="atn">charset</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"UTF-8"</span><span class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;title&gt;</span><span class="pln">Audio and Video</span><span class="tag">&lt;/title&gt;</span><span class="pln">
   </span><span class="tag">&lt;/head&gt;</span><span class="pln">
   
   </span><span class="tag">&lt;body&gt;</span><span class="pln">
      </span><span class="tag">&lt;video</span><span class="pln"> </span><span class="atn">autoplay</span><span class="tag">&gt;&lt;/video&gt;</span><span class="pln">
      </span><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"text/javascript"</span><span class="tag">&gt;</span><span class="pln">
         </span><span class="kwd">function</span><span class="pln"> errorCallback</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Error'</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">)</span><span class="pln">
         </span><span class="pun">}</span><span class="pln">

         navigator</span><span class="pun">.</span><span class="pln">getUserMedia</span><span class="pun">({</span><span class="pln">video</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> audio</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">},</span><span class="pln"> </span><span class="pun">(</span><span class="pln">localMediaStream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> video </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'video'</span><span class="pun">)</span><span class="pln">
            video</span><span class="pun">.</span><span class="pln">src </span><span class="pun">=</span><span class="pln"> window</span><span class="pun">.</span><span class="pln">URL</span><span class="pun">.</span><span class="pln">createObjectURL</span><span class="pun">(</span><span class="pln">localMediaStream</span><span class="pun">)</span><span class="pln">
            video</span><span class="pun">.</span><span class="pln">onloadedmetadata </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
               </span><span class="com">// Ready to go. Do some stuff.</span><span class="pln">
            </span><span class="pun">};</span><span class="pln">
         </span><span class="pun">},</span><span class="pln"> errorCallback</span><span class="pun">)</span><span class="pln">
      </span><span class="tag">&lt;/script&gt;</span><span class="pln">
   </span><span class="tag">&lt;/body&gt;</span><span class="pln">
</span><span class="tag">&lt;/html&gt;</span></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O programa acima gerará a seguinte saída -</font></font></p>
<img src="https://www.tutorialspoint.com/electron/images/audiovideo.jpg" alt="Transmissão de áudio e vídeo">
<p>You now have the stream from both your webcam and your microphone. You can send this stream over the network or save this in a format you like.</p>
<p>Have a look at the <a target="_blank" rel="nofollow">MDN Documentation</a> for capturing images to get the images from your webcam and store them. This was done using the HTML5 <i>getUserMedia</i> API. You can also capture the user desktop using the <i>desktopCapturer</i> module that comes with Electron. Let us now see an example of how to get the screen stream.</p>
<p>Use the same main.js file as above and edit the index.html file to have the following content −</p>
<pre class="prettyprint notranslate prettyprinted" style=""><span class="pln">desktopCapturer</span><span class="pun">.</span><span class="pln">getSources</span><span class="pun">({</span><span class="pln">types</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'window'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'screen'</span><span class="pun">]},</span><span class="pln"> </span><span class="pun">(</span><span class="pln">error</span><span class="pun">,</span><span class="pln"> sources</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">error</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throw</span><span class="pln"> error
   </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">let</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> sources</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sources</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">name </span><span class="pun">===</span><span class="pln"> </span><span class="str">'Your Window Name here!'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
         navigator</span><span class="pun">.</span><span class="pln">webkitGetUserMedia</span><span class="pun">({</span><span class="pln">
            audio</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln">
            video</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
               mandatory</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                  chromeMediaSource</span><span class="pun">:</span><span class="pln"> </span><span class="str">'desktop'</span><span class="pun">,</span><span class="pln">
                  chromeMediaSourceId</span><span class="pun">:</span><span class="pln"> sources</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">id</span><span class="pun">,</span><span class="pln">
                  minWidth</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1280</span><span class="pun">,</span><span class="pln">
                  maxWidth</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1280</span><span class="pun">,</span><span class="pln">
                  minHeight</span><span class="pun">:</span><span class="pln"> </span><span class="lit">720</span><span class="pun">,</span><span class="pln">
                  maxHeight</span><span class="pun">:</span><span class="pln"> </span><span class="lit">720</span><span class="pln">
               </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
         </span><span class="pun">},</span><span class="pln"> handleStream</span><span class="pun">,</span><span class="pln"> handleError</span><span class="pun">)</span><span class="pln">
         </span><span class="kwd">return</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">
</span><span class="pun">})</span><span class="pln">

</span><span class="kwd">function</span><span class="pln"> handleStream </span><span class="pun">(</span><span class="pln">stream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'video'</span><span class="pun">).</span><span class="pln">src </span><span class="pun">=</span><span class="pln"> URL</span><span class="pun">.</span><span class="pln">createObjectURL</span><span class="pun">(</span><span class="pln">stream</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">function</span><span class="pln"> handleError </span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilizamos o </font><font style="vertical-align: inherit;">módulo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desktopCapturer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para obter as informações sobre cada janela aberta. </font><font style="vertical-align: inherit;">Agora você pode capturar os eventos de um aplicativo específico ou de toda a tela, dependendo do nome que você passa para a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afirmação if</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acima </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Isso transmitirá apenas o que está acontecendo nessa tela para o seu aplicativo.</font></font></p>
<img src="https://www.tutorialspoint.com/electron/images/desktopcapture.jpg" alt="Captador de área de trabalho">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você pode consultar </font></font><a rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta questão do StackOverflow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para entender o uso em detalhes.</font></font></p>





<!-- PRINTING ENDS HERE -->